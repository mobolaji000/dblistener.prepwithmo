version: '3'
services:
    redis:
        image: redis:4.0.6-alpine
        command: redis-server --requirepass ${REDIS_PASSWORD}
        ports:
          - "6379:6379"
        volumes:
            - ./redis:/redis

    flask-app:
        image: messages.prepwithmo
        container_name: service.dblistener.prepwithmo
        build:
          context: .
          dockerfile: Dockerfile.Service.Local

#        extra_hosts:
#            - "host:app-27fee962-3fa3-41cb-aecc-35d29dbd568e-do-user-9096158-0.b.db.ondigitalocean.com:25060"

        restart: always
        ports:
            - '5003'
        volumes:
            - ./dblistener.prepwithmo:/service-app

    worker:
        image: worker.dblistener.prepwithmo
        container_name: worker.dblistener.prepwithmo
        build:
            context: .
            dockerfile: Dockerfile.Worker.Local
        depends_on:
            - redis
#        extra_hosts:
#            - "host:app-27fee962-3fa3-41cb-aecc-35d29dbd568e-do-user-9096158-0.b.db.ondigitalocean.com:25060"
        environment:
            - REDIS_PASSWORD=${REDIS_PASSWORD}
        volumes:
            - ./dblistener.prepwithmo:/worker-app
        command: rq worker --url redis://:${REDIS_PASSWORD}@redis:6379
        links:
            - redis
